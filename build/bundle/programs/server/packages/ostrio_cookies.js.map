{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio:cookies/cookies.js"],"names":["module","export","Cookies","Meteor","link","v","HTTP","WebApp","isServer","require","NoOp","urlRE","helpers","isUndefined","obj","isArray","Array","clone","isObject","slice","Object","assign","_helpers","i","length","prototype","toString","call","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","tryDecode","str","d","e","parse","options","Error","opt","val","key","eqIndx","split","forEach","pair","indexOf","substr","trim","unescape","antiCircular","_obj","object","cache","Map","JSON","stringify","value","get","set","serialize","name","test","escape","sanitizedValue","stringified","pairs","isNumber","maxAge","push","domain","path","expires","expire","Infinity","Date","toUTCString","httpOnly","secure","firstPartyOnly","sameSite","cookieString","join","isStringifiedRegEx","isTypedRegEx","deserialize","string","match","console","error","__cookies","constructor","_cookies","TTL","runOnServer","response","cookies","_tmp","hasOwnProperty","opts","undefined","isClient","document","cookie","setHeader","remove","keys","has","send","cb","window","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","__middlewareHandler","req","res","self","headers","auto","handler","isLoadedOnServer","connectHandlers","use","next","_parsedUrl","cookiesObject","cookiesKeys","cookiesArray","includes","writeHead","end","middleware"],"mappings":"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","file":"/packages/ostrio_cookies.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nlet HTTP;\nlet WebApp;\n\nif (Meteor.isServer) {\n  WebApp = require('meteor/webapp').WebApp;\n} else {\n  HTTP = require('meteor/http').HTTP;\n}\n\nconst NoOp  = () => {};\nconst urlRE = /\\/___cookie___\\/set/;\nconst helpers = {\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n  isArray(obj) {\n    return Array.isArray(obj);\n  },\n  clone(obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  }\n};\nconst _helpers = ['Number', 'Object'];\nfor (let i = 0; i < _helpers.length; i++) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n}\n\n/*\n * @url https://github.com/jshttp/cookie/blob/master/index.js\n * @name cookie\n * @author jshttp\n * @license\n * (The MIT License)\n *\n * Copyright (c) 2012-2014 Roman Shtylman <shtylman@gmail.com>\n * Copyright (c) 2015 Douglas Christopher Wilson <doug@somethingdoug.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nconst decode = decodeURIComponent;\nconst encode = encodeURIComponent;\nconst pairSplitRegExp = /; */;\n\n/*\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\nconst fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/*\n * @function\n * @name tryDecode\n * @param {String} str\n * @param {Function} d\n * @summary Try decoding a string using a decoding function.\n * @private\n */\nconst tryDecode = (str, d) => {\n  try {\n    return d(str);\n  } catch (e) {\n    return str;\n  }\n};\n\n/*\n * @function\n * @name parse\n * @param {String} str\n * @param {Object} [options]\n * @return {Object}\n * @summary\n * Parse a cookie header.\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n * @private\n */\nconst parse = (str, options) => {\n  if (typeof str !== 'string') {\n    throw new Meteor.Error(404, 'argument str must be a string');\n  }\n  const obj = {};\n  const opt = options || {};\n  let val;\n  let key;\n  let eqIndx;\n\n  str.split(pairSplitRegExp).forEach((pair) => {\n    eqIndx = pair.indexOf('=');\n    if (eqIndx < 0) {\n      return;\n    }\n    key = pair.substr(0, eqIndx).trim();\n    key = tryDecode(unescape(key), (opt.decode || decode));\n    val = pair.substr(++eqIndx, pair.length).trim();\n    if (val[0] === '\"') {\n      val = val.slice(1, -1);\n    }\n    if (void 0 === obj[key]) {\n      obj[key] = tryDecode(val, (opt.decode || decode));\n    }\n  });\n  return obj;\n};\n\n/*\n * @function\n * @name antiCircular\n * @param data {Object} - Circular or any other object which needs to be non-circular\n */\nconst antiCircular = (_obj) => {\n  const object = helpers.clone(_obj);\n  const cache  = new Map();\n  return JSON.stringify(object, (key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (cache.get(value)) {\n        return void 0;\n      }\n      cache.set(value, true);\n    }\n    return value;\n  });\n};\n\n/*\n * @function\n * @name serialize\n * @param {String} name\n * @param {String} val\n * @param {Object} [options]\n * @return { cookieString: String, sanitizedValue: Mixed }\n * @summary\n * Serialize data into a cookie header.\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n * serialize('foo', 'bar', { httpOnly: true }) => \"foo=bar; httpOnly\"\n * @private\n */\nconst serialize = (key, val, opt = {}) => {\n  let name;\n\n  if (!fieldContentRegExp.test(key)) {\n    name = escape(key);\n  } else {\n    name = key;\n  }\n\n  let sanitizedValue = val;\n  let value = val;\n  if (!helpers.isUndefined(value)) {\n    if (helpers.isObject(value) || helpers.isArray(value)) {\n      const stringified = antiCircular(value);\n      value = encode(`JSON.parse(${stringified})`);\n      sanitizedValue = JSON.parse(stringified);\n    } else {\n      value = encode(value);\n      if (value && !fieldContentRegExp.test(value)) {\n        value = escape(value);\n      }\n    }\n  } else {\n    value = '';\n  }\n\n  const pairs = [`${name}=${value}`];\n\n  if (helpers.isNumber(opt.maxAge)) {\n    pairs.push(`Max-Age=${opt.maxAge}`);\n  }\n\n  if (opt.domain && typeof opt.domain === 'string') {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new Meteor.Error(404, 'option domain is invalid');\n    }\n    pairs.push(`Domain=${opt.domain}`);\n  }\n\n  if (opt.path && typeof opt.path === 'string') {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new Meteor.Error(404, 'option path is invalid');\n    }\n    pairs.push(`Path=${opt.path}`);\n  }\n\n  opt.expires = opt.expires || opt.expire || false;\n  if (opt.expires === Infinity) {\n    pairs.push('Expires=Fri, 31 Dec 9999 23:59:59 GMT');\n  } else if (opt.expires instanceof Date) {\n    pairs.push(`Expires=${opt.expires.toUTCString()}`);\n  } else if (opt.expires === 0) {\n    pairs.push('Expires=0');\n  } else if (helpers.isNumber(opt.expires)) {\n    pairs.push(`Expires=${(new Date(opt.expires)).toUTCString()}`);\n  }\n\n  if (opt.httpOnly) {\n    pairs.push('HttpOnly');\n  }\n\n  if (opt.secure) {\n    pairs.push('Secure');\n  }\n\n  if (opt.firstPartyOnly) {\n    pairs.push('First-Party-Only');\n  }\n\n  if (opt.sameSite) {\n    pairs.push('SameSite');\n  }\n\n  return { cookieString: pairs.join('; '), sanitizedValue };\n};\n\nconst isStringifiedRegEx = /JSON\\.parse\\((.*)\\)/;\nconst isTypedRegEx = /false|true|null|undefined/;\nconst deserialize = (string) => {\n  if (typeof string !== 'string') {\n    return string;\n  }\n\n  if (isStringifiedRegEx.test(string)) {\n    let obj = string.match(isStringifiedRegEx)[1];\n    if (obj) {\n      try {\n        return JSON.parse(decode(obj));\n      } catch (e) {\n        console.error('[ostrio:cookies] [.get()] [deserialize()] Exception:', e, string, obj);\n        return string;\n      }\n    }\n    return string;\n  } else if (isTypedRegEx.test(string)) {\n    return JSON.parse(string);\n  }\n  return string;\n};\n\n/*\n * @locus Anywhere\n * @class __cookies\n * @param _cookies {Object|String} - Current cookies as String or Object\n * @param TTL {Number} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param runOnServer {Boolean} - Expose Cookies class to Server\n * @param response {http.ServerResponse|Object} - This object is created internally by a HTTP server\n * @summary Internal Class\n */\nclass __cookies {\n  constructor(_cookies, TTL, runOnServer, response) {\n    this.TTL         = TTL;\n    this.response    = response;\n    this.runOnServer = runOnServer;\n\n    if (helpers.isObject(_cookies)) {\n      this.cookies = _cookies;\n    } else {\n      this.cookies = parse(_cookies);\n    }\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name get\n   * @param {String} key  - The name of the cookie to read\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Read a cookie. If the cookie doesn't exist a null value will be returned.\n   * @returns {String|void}\n   */\n  get(key, _tmp) {\n    const cookieString = _tmp ? parse(_tmp) : this.cookies;\n    if (!key || !cookieString) {\n      return void 0;\n    }\n\n    if (cookieString.hasOwnProperty(key)) {\n      return deserialize(cookieString[key]);\n    }\n\n    return void 0;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name set\n   * @param {String}  key   - The name of the cookie to create/overwrite\n   * @param {String}  value - The value of the cookie\n   * @param {Object}  opts  - [Optional] Cookie options (see readme docs)\n   * @summary Create/overwrite a cookie.\n   * @returns {Boolean}\n   */\n  set(key, value, opts = {}) {\n    if (key && !helpers.isUndefined(value)) {\n      if (helpers.isNumber(this.TTL) && opts.expires === undefined) {\n        opts.expires = new Date(+new Date() + this.TTL);\n      }\n      const { cookieString, sanitizedValue } = serialize(key, value, opts);\n      this.cookies[key] = sanitizedValue;\n      if (Meteor.isClient) {\n        document.cookie = cookieString;\n      } else {\n        this.response.setHeader('Set-Cookie', cookieString);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name remove\n   * @param {String} key    - The name of the cookie to create/overwrite\n   * @param {String} path   - [Optional] The path from where the cookie will be\n   * readable. E.g., \"/\", \"/mydir\"; if not specified, defaults to the current\n   * path of the current document location (string or null). The path must be\n   * absolute (see RFC 2965). For more information on how to use relative paths\n   * in this argument, see: https://developer.mozilla.org/en-US/docs/Web/API/document.cookie#Using_relative_URLs_in_the_path_parameter\n   * @param {String} domain - [Optional] The domain from where the cookie will\n   * be readable. E.g., \"example.com\", \".example.com\" (includes all subdomains)\n   * or \"subdomain.example.com\"; if not specified, defaults to the host portion\n   * of the current document location (string or null).\n   * @summary Remove a cookie(s).\n   * @returns {Boolean}\n   */\n  remove(key, path = '/', domain = '') {\n    if (key && this.cookies.hasOwnProperty(key)) {\n      const { cookieString } = serialize(key, '', {\n        domain,\n        path,\n        expires: new Date(0)\n      });\n\n      delete this.cookies[key];\n      if (Meteor.isClient) {\n        document.cookie = cookieString;\n      } else {\n        this.response.setHeader('Set-Cookie', cookieString);\n      }\n      return true;\n    } else if (!key && this.keys().length > 0 && this.keys()[0] !== '') {\n      const keys = Object.keys(this.cookies);\n      for (let i = 0; i < keys.length; i++) {\n        this.remove(keys[i]);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name has\n   * @param {String} key  - The name of the cookie to create/overwrite\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Check whether a cookie exists in the current position.\n   * @returns {Boolean}\n   */\n  has(key, _tmp) {\n    const cookieString = _tmp ? parse(_tmp) : this.cookies;\n    if (!key || !cookieString) {\n      return false;\n    }\n\n    return cookieString.hasOwnProperty(key);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name keys\n   * @summary Returns an array of all readable cookies from this location.\n   * @returns {[String]}\n   */\n  keys() {\n    if (this.cookies) {\n      return Object.keys(this.cookies);\n    }\n    return [];\n  }\n\n  /*\n   * @locus Client\n   * @memberOf __cookies\n   * @name send\n   * @param cb {Function} - Callback\n   * @summary Send all cookies over XHR to server.\n   * @returns {void}\n   */\n  send(cb = NoOp) {\n    if (Meteor.isServer) {\n      cb(new Meteor.Error(400, 'Can\\'t run `.send()` on server, it\\'s Client only method!'));\n    }\n\n    if (this.runOnServer) {\n      HTTP.get(`${window.__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || ''}/___cookie___/set`, cb);\n    } else {\n      cb(new Meteor.Error(400, 'Can\\'t send cookies on server when `runOnServer` is false.'));\n    }\n    return void 0;\n  }\n}\n\n/*\n * @function\n * @locus Server\n * @summary Middleware handler\n * @private\n */\nconst __middlewareHandler = (req, res, self) => {\n  let _cookies = {};\n  if (self.runOnServer) {\n    if (req.headers && req.headers.cookie) {\n      _cookies = parse(req.headers.cookie);\n    }\n    return new __cookies(_cookies, self.TTL, self.runOnServer, res);\n  }\n\n  throw new Meteor.Error(400, 'Can\\'t use middleware when `runOnServer` is false.');\n};\n\n\n/*\n * @locus Anywhere\n * @class Cookies\n * @param opts {Object}\n * @param opts.TTL {Number} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param opts.auto {Boolean} - [Server] Auto-bind in middleware as `req.Cookies`, by default `true`\n * @param opts.handler {Function} - [Server] Middleware handler\n * @param opts.runOnServer {Boolean} - Expose Cookies class to Server\n * @summary Main Cookie class\n */\nclass Cookies extends __cookies {\n  constructor(opts = {}) {\n    opts.TTL = helpers.isNumber(opts.TTL) ? opts.TTL : false;\n    opts.runOnServer = (opts.runOnServer !== false) ? true : false;\n\n    if (Meteor.isClient) {\n      super(document.cookie, opts.TTL, opts.runOnServer);\n    } else {\n      super({}, opts.TTL, opts.runOnServer);\n      opts.auto        = opts.auto !== false ? true : false;\n      this.handler     = opts.handler || (() => {});\n      this.runOnServer = opts.runOnServer;\n\n      if (this.runOnServer) {\n        if (!Cookies.isLoadedOnServer) {\n          if (opts.auto) {\n            WebApp.connectHandlers.use((req, res, next) => {\n              if (urlRE.test(req._parsedUrl.path)) {\n                if (req.headers && req.headers.cookie) {\n                  const cookiesObject = parse(req.headers.cookie);\n                  const cookiesKeys   = Object.keys(cookiesObject);\n                  const cookiesArray  = [];\n\n                  for (let i = 0; i < cookiesKeys.length; i++) {\n                    const { cookieString } = serialize(cookiesKeys[i], cookiesObject[cookiesKeys[i]]);\n                    if (!cookiesArray.includes(cookieString)) {\n                      cookiesArray.push(cookieString);\n                    }\n                  }\n\n                  res.setHeader('Set-Cookie', cookiesArray);\n                }\n\n                res.writeHead(200);\n                res.end('');\n              } else {\n                req.Cookies = __middlewareHandler(req, res, this);\n                next();\n              }\n            });\n          }\n          Cookies.isLoadedOnServer = true;\n        }\n      }\n    }\n  }\n\n\n  /*\n   * @locus Server\n   * @memberOf Cookies\n   * @name middleware\n   * @summary Get Cookies instance into callback\n   * @returns {void}\n   */\n  middleware() {\n    if (!Meteor.isServer) {\n      throw new Meteor.Error(500, '[ostrio:cookies] Can\\'t use `.middleware()` on Client, it\\'s Server only!');\n    }\n\n    return (req, res, next) => {\n      this.handler && this.handler(__middlewareHandler(req, res, this));\n      next();\n    };\n  }\n}\n\nif (Meteor.isServer) {\n  Cookies.isLoadedOnServer = false;\n}\n\n/* Export the Cookies class */\nexport { Cookies };\n"]}