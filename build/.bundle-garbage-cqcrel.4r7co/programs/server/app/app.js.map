{"version":3,"sources":["meteor://ðŸ’»app/imports/api/form/server/methods.js","meteor://ðŸ’»app/imports/api/form/server/publications.js","meteor://ðŸ’»app/imports/api/users/server/publications.js","meteor://ðŸ’»app/imports/startup/both/Expenses.js","meteor://ðŸ’»app/imports/startup/both/Images.js","meteor://ðŸ’»app/imports/startup/server/api.js","meteor://ðŸ’»app/imports/startup/server/index.js","meteor://ðŸ’»app/imports/startup/server/route.js","meteor://ðŸ’»app/server/main.js"],"names":["Meteor","module","link","v","Expenses","default","methods","amount","date","fileId","desc","type","insert","userId","id","remove","_id","Expense","Images","Promise","Moment","publish","current_date","endOf","format","target_date","startOf","subtract","find","$gte","Date","$lt","first_run","self","start_date","end_date","query","observeChanges","added","obj","newImage","findOne","image","fetch","removed","fetchHandle","expenses","await","aggregate","$match","$lookup","from","localField","foreignField","as","toArray","map","ready","users","Mongo","exportDefault","Collection","export","StoragePath","FilesCollection","settings","STORAGE_PATH","collectionName","storagePath","Picker","fs","route","params","req","res","next","existsSync","path","file","readFileSync","end"],"mappings":"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","file":"/app.js","sourcesContent":["import { Meteor } from \"meteor/meteor\";\n\nimport Expenses from \"../../../startup/both/Expenses\";\n\nMeteor.methods({\n    \"form.insert\": (amount, date, fileId, desc, type) => {\n        return Expenses.insert({ userId: Meteor.userId(), amount, date, fileId, desc, type })\n    },\n    \"form.remove\": (id) => {\n        return Expenses.remove({ userId: Meteor.userId(), _id: id });\n    }\n});","/* eslint-disable import/no-unresolved */\nimport { Meteor } from 'meteor/meteor';\nimport Expense from \"../../../startup/both/Expenses\";\nimport Images from \"../../../startup/both/Images\";\nimport { Promise } from 'meteor/promise';\nimport Moment from \"moment\";\n\nMeteor.publish('expense.six_month', () => {\n    if(!Meteor.userId()) return false;\n    let current_date = Moment().endOf('month').endOf('day').format();\n    let target_date = Moment().startOf('month').startOf('day').subtract(5, 'months').format();\n    return Expense.find({ \n        userId: Meteor.userId(), \n        date: {\n            $gte: new Date(target_date),\n            $lt: new Date(current_date)\n        }\n    });\n});\n\nMeteor.publish('expense.this_month', function() {\n    if(!Meteor.userId()) return false;\n    let first_run = true;\n    const self = this;\n    const start_date = Moment().startOf('month').startOf('day').format();\n    const end_date = Moment().endOf('month').endOf('day').format();\n    const query = { \n        userId: Meteor.userId(),\n        date: {\n            $gte: new Date(start_date),\n            $lt: new Date(end_date)\n        }\n    };\n    Expense.find(query).observeChanges({\n        added: (id, obj) => {\n            if(!first_run){\n                newImage = Images.findOne(obj.fileId);\n                if(newImage){\n                    self.added('expenses', id, { \n                        ...obj,\n                        image: newImage.fetch()\n                    })\n                }\n            }\n        },\n        removed: (id) => {\n            if(!first_run){\n                self.removed('expenses', id);\n            }\n        }\n    });\n    const fetchHandle = () => {\n        const expenses = Promise.await(Expense.aggregate([\n            { $match: query },\n            {\n                $lookup: {\n                    from: \"Images\",\n                    localField: \"fileId\",\n                    foreignField: \"_id\",\n                    as: \"image\"\n                }\n            },\n            {\n                \"$project\": {\n                    \"_id\": 1,\n                    \"amount\": 1,\n                    \"desc\": 1,\n                    \"image\": 1\n                }\n            }\n        ]).toArray());\n        expenses.map((obj) => {\n            self.added(\"expenses\", obj._id, { ...obj });\n        });\n        if(first_run){\n            first_run = false;\n            self.ready();\n        }\n    }\n    fetchHandle();\n});","/* eslint-disable import/no-unresolved */\nimport { Meteor } from 'meteor/meteor';\n\nMeteor.publish('users', () => Meteor.users.find());","import { Mongo } from 'meteor/mongo';\n\nexport default Expenses = new Mongo.Collection('expenses');\n","import { FilesCollection } from 'meteor/ostrio:files';\n\nconst StoragePath = Meteor.settings.STORAGE_PATH;\n\nconst Images = new FilesCollection({\n    collectionName: 'Images',\n    storagePath: StoragePath\n});\n\nexport { StoragePath };\nexport default Images;","/**\n * users\n */\n\nimport \"../both/Images\";\nimport \"../../api/form/server/methods\";\nimport \"../../api/form/server/publications\";\nimport '../../api/users/server/methods';\nimport '../../api/users/server/publications';","import './api';\nimport './route';\n","import { Picker } from 'meteor/meteorhacks:picker';\nimport { StoragePath } from \"../both/Images\";\nimport fs from \"fs\";\n\nPicker.route('/file/:path', function(params, req, res, next) {\n    if(fs.existsSync(StoragePath + \"/\" + params.path)){\n        const file = fs.readFileSync(StoragePath + \"/\" + params.path);\n        res.end(file);\n    } else {\n        res.end(\"File not found.\");\n    }\n});","import '../imports/startup/server/index';\n"]}